meta:
  title: DUCK Rulebase
  description:
  version: 0.51
  id: 123   # hack, until the user can select the rulebase with the user interface.

language:
  action/2: action(%s,%s)
  compatiblePurpose/2: compatiblePurpose(%s,%s)
  notCompatiblePurpse/2: notCompatiblePurpose(%s,%s)
  notConsentRequired/1: notConsentRequired(%s)
  consentRequired/1: consentRequired(%s)
  dataCategory/2: dataCategory(%s,%s)
  dataUseStatement/1: dataUseStatement(%s)
  docConsentRequired: docConsentRequired
  notDocConsentRequired: notDocConsentRequired
  duplicate/2: duplicate(%s,%s)
  equivalentScope/2: equivalentScope(%s,%s)
  extendsScope/2: extendsScope(%s,%s)
  greaterScope/2: greaterScope(%s,%s)
  id/2: id(%s,%s)
  kindOf/2: kindOf(%s,%s)
  lesserScope/2: lesserScope(%s,%s)
  li/1: li(%s)
  notLi/1: notLi(%s)
  pii/1: pii(%s)
  notPii/1: notPii(%s)
  passive/2: passive(%s,%t)
  partOf/2: partOf(%s,%s)
  qualifier/2: qualifier(%s,%s)
  resultScope/2: resultScope(%s,%s)
  smallerOrEqualScope/2: smallerOrEqualScope(%s,%s)
  scope/2: scope(%s,%s)
  sourceScope/2: sourceScope(%s,%s)
  useScope/2: useScope(%s,%s)


issue_schemes:
  compatiblePurpose: [compatiblePurpose(S), notCompatiblePurpose(S)]
  consent: [consentRequired(S), notConsentRequired(S)]
  docConsent: [docConsentRequired, notDocConsentRequired]
  li: [li(S), notLi(S)]
  pii: [pii(S), notPii(S)]

argument_schemes:

  selectors:
    variables: [UseScope,Qualifier,DataCategory,SourceScope,Action,ResultScope,ID,Passive]
    premises:
      - dataUseStatement(dus(UseScope,Qualifier,DataCategory,SourceScope,Action,ResultScope,ID,Passive))
    conclusions:
      - useScope(dus(UseScope,Qualifier,DataCategory,SourceScope,Action,ResultScope,ID,Passive),UseScope)
      - qualifier(dus(UseScope,Qualifier,DataCategory,SourceScope,Action,ResultScope,ID,Passive),Qualifier)
      - dataCategory(dus(UseScope,Qualifier,DataCategory,SourceScope,Action,ResultScope,ID,Passive),DataCategory)
      - sourceScope(dus(UseScope,Qualifier,DataCategory,SourceScope,Action,ResultScope,ID,Passive),SourceScope)
      - action(dus(UseScope,Qualifier,DataCategory,SourceScope,Action,ResultScope,ID,Passive),Action)
      - resultScope(dus(UseScope,Qualifier,DataCategory,SourceScope,Action,ResultScope,ID,Passive),ResultScope)
      - id(dus(UseScope,Qualifier,DataCategory,SourceScope,Action,ResultScope,ID,Passive),ID)
      - passive(dus(UseScope,Qualifier,DataCategory,SourceScope,Action,ResultScope,ID,Passive),Passive)

  # kindOf Rules

  kindOfTransitivity:
    variables: [X,Y,Z]
    premises:
      - kindOf(X,Y)
      - kindOf(Y,Z)
    conclusions:
      - kindOf(X,Z)

  # partOf Rules
  
  partOfTransitivity:
    variables: [X,Y,Z]
    premises:
      - partOf(X,Y)
      - partOf(Y,Z)
    conclusions:
     - partOf(X,Z)

  # Data Qualifier Rules

  qualifier1:
    variables: [S]
    premises:
      - qualifier(S,identified_data)
    conclusions:
      - qualifier(S,unqualified_or_identified)

  qualifier2:
    variables: [S]
    premises:
      - qualifier(S,unqualified)  # ToDo: not yet in the taxonomy
    conclusions:
      - qualifier(S,unqualified_or_identified)

  # Scope Rules
  # Wider scopes include narrower scopes, expect for third_party items, which
  # independent scope.  For example, the service scope includes
  # the capability scope.
  
  scope1:
    variables: [S]
    premises:
      - scope(S,csp_products)
    conclusions:
      - scope(S,csp_services)

  scope2:
    variables: [S]
    premises:
      - scope(S,csp_services)
    conclusions:
      - scope(S,services_agreement)

  scope3:
    variables: [S]
    premises:
      - scope(S,services_agreement)
    conclusions:
      - scope(S,service)

  scope4:
    variables: [S]
    premises:
      - scope(S,service)
    conclusions:
      - scope(S,cability)

  # Data Category Rules

  category0:
    variables: [S,X,Y]
    premises:
      - dataCategory(S,X)
      - kindOf(X,Y)
    conclusions:
      - dataCategory(S,Y)
      
  category1:
    conclusions:
      - kindOf(derived_data_user_telemetry,derived_data_user)

  category2:
    conclusions:
      - kindOf(derived_data_user_connectivity,derived_data_user)

  category3:
    conclusions:
      - kindOf(derived_data_user_usage,derived_data_user)

  category4:
    conclusions:
      - kindOf(derived_data_user_demographic,derived_data_user)

  category5:
    conclusions:
      - kindOf(derived_data_user_profiling,derived_data_user)

  category6:
    conclusions:
      - kindOf(derived_data_user_content,derived_data_user)

  category7:
    conclusions:
      - kindOf(derived_data_user_browsing,derived_data_user)

  category8:
    conclusions:
      - kindOf(derived_data_user_search,derived_data_user)

  category9:
    conclusions:
      - kindOf(derived_data_user_location,derived_data_user)

  category10:
    conclusions:
      - kindOf(derived_data_user_social,derived_data_user)

  category11:
    conclusions:
      - kindOf(derived_data_user_biometric,derived_data_user)

  category12:
    conclusions:
      - kindOf(derived_data_user_contact,derived_data_user)

  category13:
    conclusions:
      - kindOf(derived_data_user_environmental,derived_data_user)

  category14:
    conclusions:
      - kindOf(customer_content_credentials,customer_content)

  category15:
    conclusions:
      - kindOf(customer_content_contact,customer_content)

  category16:
    conclusions:
      - kindOf(customer_content_health,customer_content)  

  category17:
    conclusions:
      - kindOf(customer_content_genetic,customer_content) 

  category18:
    conclusions:
      - kindOf(customer_content_biometric,customer_content) 

  category19:
    conclusions:
      - kindOf(customer_content_children,customer_content) 

  category20:
    conclusions:
      - kindOf(customer_content_opinions,customer_content) 

  category21:
    conclusions:
      - kindOf(customer_content_financial,customer_content) 

  category22:
    conclusions:
      - kindOf(derived_data_user,derived_data)

  category23:
    conclusions:
      - kindOf(derived_data_organization,derived_data)

  category24:
    conclusions:
      - kindOf(provider_data_authentication,provider_data)  

  category25:
    conclusions:
      - kindOf(provider_data_operations,provider_data) 

  category26:
    conclusions:
      - kindOf(account_data_customer,account_data)

  category27:
    conclusions:
      - kindOf(account_data_payment,account_data)

  # Action Rules

  action0:
    variables: [S,X,Y]
    premises:
      - action(S,X)
      - kindOf(X,Y)
    conclusions:
      - action(S,Y)
      
  action1:
    conclusions:
      - kindOf(market,market_advertise_promote) # To Do: Not in taxonomy

  action2:
    conclusions:
      - kindOf(advertise,market_advertise_promote) # To Do: Not in taxonomy

  action3:
    conclusions:
      - kindOf(promote,market_advertise_promote) # To Do: Not in taxonomy

  action4:
    conclusions:
      - kindOf(market_contextual,market)

  action5:
    conclusions:
      - kindOf(market_personalization,market)

  action6:
    conclusions:
      - kindOf(advertise_contextual,advertise)

  action7:
    conclusions:
      - kindOf(advertise_personalization,advertise)      

  action8:
    conclusions:
      - kindOf(promote_contextual,promote)

  action9:
    conclusions:
      - kindOf(promote_personalization,promote)        

  action10:
    conclusions:
      - kindOf(share_provide,share)            
      
  # docConsent Rules
  
  docConsent1:
    meta:
       comment: >
          By default, a data use document does not require informed consent
    weight:
       constant: 0.1   
    conclusions:
      - notDocConsentRequired

  docConsent2:
    meta:
       comment: >
          A data use document does require informed consent
          if any of its data use statements requires informed consent.
    variables: [S]
    premises:
      - consentRequired(S)
    conclusions:
      - docConsentRequired

  # PII Rules

  pii0:
    meta:
      comment: Assume by default that the information is not personal
    weight:
      constant: 0.1 
    variables: [S]
    premises:
      - dataUseStatement(S)
    conclusions:
      - notPii(S)

  pii1:
    variables: [S]
    premises:
      - qualifier(S,unqualified_or_identified)
    conclusions:
      - pii(S)
    exceptions:
      - dataCategory(S,provider_data_operations)

  pii2:
    variables: [S]
    premises:
      - qualifier(S,pseudonymized_data)
    conclusions:
      - pii(S)
    exceptions:
      - dataCategory(S,derived_data_organization)
      
  pii3:
    variables: [S]
    premises:
      - qualifier(S,unlinked_data)  
    conclusions:
      - notPii(S)

  pii4:
    variables: [S]
    premises:
      - qualifier(S,anonymized_data)  
    conclusions:
      - notPii(S)


  pii5:
    variables: [S]
    premises:
      - qualifier(S,aggregated_data)  
    conclusions:
      - notPii(S)

  pii6:
    variables: [S]
    premises:
      - qualifier(S,pseudonymized_data)
      - dataCategory(S,derived_data_organization)
    conclusions:
      - notPii(S)

  pii7:
    variables: [S]
    premises:
      - qualifier(S,pseudonymized_data)
      - dataCategory(S,provider_data_authentication) 
    conclusions:
      - notPii(S)

  pii8:
    variables: [S]
    premises:
      - qualifier(S,unqualified_or_identified)
      - dataCategory(S,derived_data_organization)
    conclusions:
      - notPii(S)

  pii9:
    variables: [S]
    premises:
      - qualifier(S,unqualified_or_identified)
      - dataCategory(S,provider_data_authentication)  
    conclusions:
      - notPii(S)

  pii10:
    variables: [S]
    premises:
      - qualifier(S,unqualified)  # ToDo: not yet in the taxonomy file!
      - dataCategory(S,customer_content_credentials)
    conclusions:
      - pii(S)    

  pii11:
    variables: [S]
    premises:
      - qualifier(S,unqualified)  # ToDo: not yet in the taxonomy file!
      - dataCategory(S,derived_data_organization)
    conclusions:
      - notPii(S)

  pii12:
    variables: [S]
    premises:
      - qualifier(S,unqualified)  # ToDo: not yet in the taxonomy file!
      - dataCategory(S,provider_data_authentication) 
    conclusions:
      - notPii(S)        

  # Legitimate Interest (LI) Rules

  li0:
    meta:
      comment: Assume by default that the interest is not legitimate
    weight:
      constant: 0.1 
    variables: [S]
    premises:
      - dataUseStatement(S)
    conclusions:
      - notLi(S)

  li1:
    variables: [S]
    premises:
      - action(S,provide)
      - resultScope(S,capability)
    conclusions:
      - li(S)  

  li2:
    variables: [S]
    premises:
      - action(S,provide)
      - resultScope(S,service) 
    conclusions:
      - li(S)
      
  li3:
    variables: [S]
    premises:
      - action(S,improve)
      - resultScope(S,capability) 
    conclusions:
      - li(S)
      
  li4:
    variables: [S]
    premises:
      - action(S,improve)
      - resultScope(S,service)
    conclusions:
      - li(S)

  li5:
    variables: [S]
    premises:
      - action(S,improve)
      - resultScope(S,services_agreement) 
    conclusions:
      - li(S)

  li6:
    variables: [S]
    premises:
      - action(S,improve)
      - resultScope(S,csp_services)
    conclusions:
      - li(S)

  li7:
    variables: [S]
    premises:
      - action(S,improve)
      - resultScope(S,csp_products)
    conclusions:
      - li(S)


  li8:
    variables: [S]
    premises:
      - action(S,personalize)
      - resultScope(S,capability)
    conclusions:
      - li(S)

  li9:
    variables: [S]
    premises:
      - action(S,personalize)
      - resultScope(S,service)
    conclusions:
      - li(S)

  li10:
    variables: [S]
    premises:
      - action(S,upgrades)
      - resultScope(S,capability)
    conclusions:
      - li(S)
      
  li11:
    variables: [S]
    premises:
      - action(S,upgrades)
      - resultScope(S,service)
    conclusions:
      - li(S)

  li12:
    variables: [S]
    premises:
      - action(S,upgrades)
      - resultScope(S,services_agreement)
    conclusions:
      - li(S)

  li13:
    variables: [S]
    premises:
      - action(S,market_advertise_promote)
      - resultScope(S,capability)
    conclusions:
      - li(S)

  li14:
    variables: [S]
    premises:
      - action(S,market_advertise_promote)
      - resultScope(S,service)
    conclusions:
      - li(S)


  # equivalentScope Rules

  equivalentScope0:
    variables: [S1,S2]
    premises:
      - resultScope(S1,S)
      - resultScope(S2,S)
    conclusions:
      - equivalentScope(S1,S2)

  equivalentScope1:
    variables: [S1,S2]
    premises:
      - resultScope(S1,capability)
      - resultScope(S2,service)
    conclusions:
      - equivalentScope(S1,S2)
      
  equivalentScope2:
    variables: [S1,S2]
    premises:
      - resultScope(S1,services_agreement)
      - resultScope(S2,csp_services)
    conclusions:
      - equivalentScope(S1,S2)
      
  equivalentScope3:
    variables: [S1,S2]
    premises:
      - resultScope(S1,third_party_partners)
      - resultScope(S2,third_party_services) 
    conclusions:
      - equivalentScope(S1,S2)

  equivalentScope4:
    variables: [S1,S2]
    premises:
      - resultScope(S1,third_party_services) 
      - resultScope(S2,third_party_partners) 
    conclusions:
      - equivalentScope(S1,S2)

  # smallerOrEqualScope Rules

  smallerOrEqualScope1:   # identity
    variables: [S1,S2,C]
    premises:
      - resultScope(S1,C) 
      - resultScope(S2,C)
    conclusions:
      - smallerOrEqualScope(S1,S2)

  # smallerOrEqualScope2:  # transitivity
  #   variables: [S1,S2,S3]
  #   premises:
  #     - smallerOrEqualScope(S1,S2) 
  #     - smallerOrEqualScope(S2,S3)
  #   conclusions:
  #     - smallerOrEqualScope(S1,S3)

  smallerOrEqualScope3:
    variables: [S1,S2,P1,P2]
    premises:
      - resultScope(S1,P1)
      - resultScope(S2,P2)
      - lesserScope(P1,P2)
    conclusions:
      - smallerOrEqualScope(S1,S2)

  # lesserScope Rules

  lesserScope1:
    conclusions:
      - lesserScope(capability,service)
      - lesserScope(service,services_agreement)
      - lesserScope(services_agreement,csp_services)
      - lesserScope(csp_services,csp_products)

  # compatiblePurpose Rules

  # compatiblePurpose0:
  #   meta:
  #     comment: Assume by default that the purpose of further processing is compatible
  #   weight:
  #     constant: 0.1 
  #   variables: [S1,S2]
  #   premises:
  #     - dataUseStatement(S1)
  #     - dataUseStatement(S2)
  #   conclusions:
  #     - compatiblePurpose(S1,S2)

  compatiblePurpose1:
    variables: [S1,S2,A]
    premises:
      - action(S1,A)
      - action(S2,A)
      - equivalentScope(S1,S2)
    conclusions:
      - compatiblePurpose(S1,S2)

  compatiblePurpose2:
    variables: [S1,S2]
    premises:
      - action(S1,provide)
      - action(S2,improve)
      - smallerOrEqualScope(S2,csp_products)
    conclusions:
      - compatiblePurpose(S1,S2)

  compatiblePurpose3:
    variables: [S1,S2]
    premises:
      - action(S1,provide)
      - action(S2,upgrades)
      - equivalentScope(S1,S2)
    conclusions:
      - compatiblePurpose(S1,S2)

  compatiblePurpose4:
    variables: [S1,S2]
    premises:
      - action(S1,provide)
      - action(S2,market_advertise_promote)
      - equivalentScope(S1,S2)
    conclusions:
      - compatiblePurpose(S1,S2)

  compatiblePurpose5:
    variables: [S1,S2]
    premises:
      - action(S1,improve)
      - action(S2,improve)
      - smallerOrEqualScope(S2,csp_products)
    conclusions:
      - compatiblePurpose(S1,S2)

  compatiblePurpose6:
    variables: [S1,S2]
    premises:
      - action(S1,personalize)
      - action(S2,personalize)
      - smallerOrEqualScope(S2,services_agreement)
    conclusions:
      - compatiblePurpose(S1,S2)

  compatiblePurpose7:
    variables: [S1,S2]
    premises:
      - action(S1,personalize)
      - action(S2,market_advertise_promote)
      - smallerOrEqualScope(S2,services_agreement)
    conclusions:
      - compatiblePurpose(S1,S2)

  compatiblePurpose8:
    variables: [S1,S2]
    premises:
      - action(S1,upgrades)
      - action(S2,upgrades)
      - smallerOrEqualScope(S2,services_agreement)
    conclusions:
      - compatiblePurpose(S1,S2)   
            
      
  # consentRequired Rules

  consentRequired1:
    variables: [S]
    premises:
      - notPii(S)
    conclusions:
      - notConsentRequired(S)

  consentRequired2:
    variables: [S]
    premises:
      - pii(S)
      - notLi(S)
    conclusions:
      - consentRequired(S)

  consentRequired3:
    variables: [S]
    premises:
      - pii(S)
      - li(S)
    conclusions:
      - notConsentRequired(S)

  # Note that consentRequired4 and consentRequired5 can lead
  # to rebuttals (arguments pro and con)
  
  # consentRequired4:
  #   variables: [S1,S2]
  #   premises:
  #     - pii(S1)
  #     - notConsentRequired(S2)
  #     - compatiblePurpose(S1,S2)
  #   conclusions:
  #     - notConsentRequired(S1)
  
  consentRequired5:
    variables: [S1,S2]
    premises:
      - pii(S1)
      - consentRequired(S2)
      - compatiblePurpose(S1,S2)
    conclusions:
      - consentRequired(S1)

